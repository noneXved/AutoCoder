name: AutoCoder
description: This action automates generating code from GitHub issues using OpenAI ChatGPT and creates a pull request with the generated code for review.
author: Your Name or Organization
inputs:
  GITHUB_TOKEN:
    description: Personal access token (PAT) used for GitHub API authentication. Required for creating pull requests and repository interactions.
    required: true
  REPOSITORY:
    description: The repository where the action will be executed.
    required: true
  ISSUE_NUMBER:
    description: The number of the issue that triggered the action.
    required: true
  OPENAI_API_KEY:
    description: API key for OpenAI, used to interact with ChatGPT for code generation.
    required: true
  SCRIPT_PATH:
    description: The path to the script that interacts with ChatGPT and generates code.
    required: true
  LABEL:
    description: Label that triggers the action.
    required: true
    default: autocoder-bot
outputs:
  pull_request_url:
    description: URL of the auto-created pull request containing generated code for review.
runs:
  using: composite
  steps:
    - name: Checkout the repository
      uses: actions/checkout@v3
    - name: Make the script executable
      run: chmod +x ${{ inputs.SCRIPT_PATH }}
      shell: bash
    - name: Interact with ChatGPT to generate code
      run: |
        ${{ inputs.SCRIPT_PATH }} "${{ inputs.GITHUB_TOKEN }}" "${{ inputs.REPOSITORY }}" "${{ inputs.ISSUE_NUMBER }}" "${{ inputs.OPENAI_API_KEY }}"
      shell: bash
      env:
        GITHUB_TOKEN: ${{ inputs.GITHUB_TOKEN }}
        OPENAI_API_KEY: ${{ inputs.OPENAI_API_KEY }}
    - name: Configure credentials and commit files
      run: |
        git config --local user.email "actions@github.com"
        git config --local user.name "autocoder-bot"
        git add .
        git commit -m "Autocoder bot: Generated files for issue #${{ inputs.ISSUE_NUMBER }}" || echo "No changes to commit"
      shell: bash
